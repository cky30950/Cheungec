<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­é†«è¨ºç—‡è¼”åŠ©å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        
        // Firebase é…ç½® - è«‹æ›¿æ›ç‚ºæ‚¨çš„å¯¦éš›é…ç½®
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // å°‡ Firebase å¯¦ä¾‹æ›è¼‰åˆ° window å°è±¡ä¾›å…¶ä»–è…³æœ¬ä½¿ç”¨
        window.firebaseDB = db;
        window.firebaseModules = {
            collection,
            doc,
            setDoc,
            getDoc,
            getDocs,
            deleteDoc
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .search-result:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-green-500">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-green-600 to-green-700 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">ä¸­</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">ä¸­é†«è¨ºç—‡è¼”åŠ©å·¥å…·</h1>
                </div>
                <div class="text-sm text-gray-600">
                    å°ˆæ¥­ç‰ˆ v1.0
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel - Search -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        æ™ºèƒ½æœå°‹
                    </h2>
                    
                    <div class="relative mb-4">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="è¼¸å…¥ç—‡ç‹€æˆ–ä¸­è—¥åç¨±é€²è¡Œæœå°‹..."
                            class="w-full px-4 py-3 pl-12 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
                        >
                        <svg class="w-5 h-5 text-gray-400 absolute left-4 top-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>

                    <div class="flex space-x-2 mb-4">
                        <button id="searchBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                            æœå°‹
                        </button>
                        <button id="clearBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                            æ¸…é™¤
                        </button>
                    </div>
                </div>

                <!-- Search Results -->
                <div id="searchResults" class="bg-white rounded-xl shadow-lg p-6 min-h-96">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">æœå°‹çµæœ</h3>
                    <div id="resultsContainer" class="text-gray-500 text-center py-12">
                        è«‹è¼¸å…¥ç—‡ç‹€æˆ–ä¸­è—¥åç¨±é–‹å§‹æœå°‹
                    </div>
                </div>
            </div>

            <!-- Right Panel - Data Import -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                        </svg>
                        è³‡æ–™å°å…¥
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            æ ¼å¼ï¼šä¸­è—¥åï¼šç—‡ç‹€
                        </label>
                        <textarea 
                            id="importData" 
                            placeholder="ä¾‹å¦‚ï¼š&#10;ç•¶æ­¸ï¼šè£œè¡€èª¿ç¶“&#10;é»ƒèŠªï¼šè£œæ°£å›ºè¡¨&#10;äººåƒï¼šå¤§è£œå…ƒæ°£"
                            class="w-full h-32 px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none resize-none"
                        ></textarea>
                    </div>
                    
                    <button id="importBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition-colors mb-4">
                        å°å…¥è³‡æ–™
                    </button>
                    
                    <div id="importStatus" class="text-sm"></div>
                </div>

                <!-- Firebase Status -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">é›²ç«¯ç‹€æ…‹</h3>
                        <div id="connectionStatus" class="flex items-center">
                            <div class="w-3 h-3 bg-gray-400 rounded-full mr-2 animate-pulse"></div>
                            <span class="text-sm text-gray-500">æª¢æ¸¬ä¸­</span>
                        </div>
                    </div>
                    
                    <div id="lastSync" class="text-sm text-gray-500 mb-3">å¾æœªåŒæ­¥</div>
                    
                    <button id="testConnectionBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-medium transition-colors">
                        ğŸ” æ¸¬è©¦é€£æ¥
                    </button>
                </div>

                <!-- Firebase Configuration Notice -->
                <div id="configNotice" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                <strong>Firebase é…ç½®æé†’ï¼š</strong><br>
                                è«‹åœ¨ä»£ç¢¼ä¸­æ›¿æ›æ‚¨çš„ Firebase é…ç½®ä¿¡æ¯æ‰èƒ½ä½¿ç”¨é›²ç«¯åŠŸèƒ½
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Data Statistics -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">è³‡æ–™çµ±è¨ˆ</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">ä¸­è—¥ç¸½æ•¸ï¼š</span>
                            <span id="herbCount" class="font-semibold text-green-600">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">ç—‡ç‹€ç¸½æ•¸ï¼š</span>
                            <span id="symptomCount" class="font-semibold text-blue-600">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">é—œè¯ç¸½æ•¸ï¼š</span>
                            <span id="relationCount" class="font-semibold text-purple-600">0</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 space-y-2">
                        <button id="saveToFirebaseBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-medium transition-colors">
                            ğŸ’¾ ä¿å­˜åˆ°é›²ç«¯
                        </button>
                        <button id="loadFromFirebaseBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-medium transition-colors">
                            â˜ï¸ å¾é›²ç«¯è¼‰å…¥
                        </button>
                        <button id="clearDataBtn" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg font-medium transition-colors">
                            ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™å­˜å„²
        let medicineData = {};
        let symptomData = {};

        // DOM å…ƒç´ 
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const importData = document.getElementById('importData');
        const importBtn = document.getElementById('importBtn');
        const importStatus = document.getElementById('importStatus');
        const herbCount = document.getElementById('herbCount');
        const symptomCount = document.getElementById('symptomCount');
        const relationCount = document.getElementById('relationCount');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const saveToFirebaseBtn = document.getElementById('saveToFirebaseBtn');
        const loadFromFirebaseBtn = document.getElementById('loadFromFirebaseBtn');
        const testConnectionBtn = document.getElementById('testConnectionBtn');
        const connectionStatus = document.getElementById('connectionStatus');
        const lastSync = document.getElementById('lastSync');
        const configNotice = document.getElementById('configNotice');

        // åˆå§‹åŒ–ç¤ºä¾‹è³‡æ–™
        function initSampleData() {
            const sampleData = [
                'ç•¶æ­¸ï¼šè£œè¡€èª¿ç¶“,æ´»è¡€æ­¢ç—›',
                'é»ƒèŠªï¼šè£œæ°£å›ºè¡¨,åˆ©æ°´æ¶ˆè…«',
                'äººåƒï¼šå¤§è£œå…ƒæ°£,å¾©è„ˆå›ºè„«',
                'ç”˜è‰ï¼šè£œè„¾ç›Šæ°£,æ¸…ç†±è§£æ¯’',
                'ç™½æœ®ï¼šå¥è„¾ç›Šæ°£,ç‡¥æ¿•åˆ©æ°´',
                'èŒ¯è‹“ï¼šåˆ©æ°´æ»²æ¿•,å¥è„¾å¯§å¿ƒ',
                'å·èŠï¼šæ´»è¡€è¡Œæ°£,ç¥›é¢¨æ­¢ç—›',
                'ç™½èŠï¼šé¤Šè¡€èª¿ç¶“,å¹³è‚æ­¢ç—›'
            ];
            
            sampleData.forEach(line => {
                processDataLine(line);
            });
            updateStatistics();
        }

        // è™•ç†å–®è¡Œè³‡æ–™
        function processDataLine(line) {
            const parts = line.split('ï¼š');
            if (parts.length === 2) {
                const medicine = parts[0].trim();
                const symptoms = parts[1].split(',').map(s => s.trim());
                
                if (!medicineData[medicine]) {
                    medicineData[medicine] = new Set();
                }
                
                symptoms.forEach(symptom => {
                    medicineData[medicine].add(symptom);
                    
                    if (!symptomData[symptom]) {
                        symptomData[symptom] = new Set();
                    }
                    symptomData[symptom].add(medicine);
                });
            }
        }

        // æœå°‹åŠŸèƒ½
        function performSearch() {
            const query = searchInput.value.trim();
            if (!query) {
                resultsContainer.innerHTML = '<div class="text-gray-500 text-center py-12">è«‹è¼¸å…¥æœå°‹å…§å®¹</div>';
                return;
            }

            let results = [];
            
            // æœå°‹ä¸­è—¥
            if (medicineData[query]) {
                const symptoms = Array.from(medicineData[query]);
                results.push({
                    type: 'medicine',
                    name: query,
                    items: symptoms,
                    title: `ä¸­è—¥ã€Œ${query}ã€çš„åŠŸæ•ˆ`
                });
            }
            
            // æœå°‹ç—‡ç‹€
            if (symptomData[query]) {
                const medicines = Array.from(symptomData[query]);
                results.push({
                    type: 'symptom',
                    name: query,
                    items: medicines,
                    title: `ç—‡ç‹€ã€Œ${query}ã€çš„å°æ‡‰ä¸­è—¥`
                });
            }
            
            // æ¨¡ç³Šæœå°‹
            if (results.length === 0) {
                // æœå°‹åŒ…å«é—œéµå­—çš„ä¸­è—¥
                Object.keys(medicineData).forEach(medicine => {
                    if (medicine.includes(query)) {
                        const symptoms = Array.from(medicineData[medicine]);
                        results.push({
                            type: 'medicine',
                            name: medicine,
                            items: symptoms,
                            title: `ä¸­è—¥ã€Œ${medicine}ã€çš„åŠŸæ•ˆ`
                        });
                    }
                });
                
                // æœå°‹åŒ…å«é—œéµå­—çš„ç—‡ç‹€
                Object.keys(symptomData).forEach(symptom => {
                    if (symptom.includes(query)) {
                        const medicines = Array.from(symptomData[symptom]);
                        results.push({
                            type: 'symptom',
                            name: symptom,
                            items: medicines,
                            title: `ç—‡ç‹€ã€Œ${symptom}ã€çš„å°æ‡‰ä¸­è—¥`
                        });
                    }
                });
            }
            
            displayResults(results, query);
        }

        // é¡¯ç¤ºæœå°‹çµæœ
        function displayResults(results, query) {
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-gray-400 text-lg mb-2">ğŸ˜”</div>
                        <div class="text-gray-500">æœªæ‰¾åˆ°ã€Œ${query}ã€çš„ç›¸é—œè³‡æ–™</div>
                        <div class="text-sm text-gray-400 mt-2">è«‹å˜—è©¦å…¶ä»–é—œéµå­—æˆ–å°å…¥æ›´å¤šè³‡æ–™</div>
                    </div>
                `;
                return;
            }

            let html = '';
            results.forEach((result, index) => {
                const bgColor = result.type === 'medicine' ? 'bg-green-50 border-green-200' : 'bg-blue-50 border-blue-200';
                const iconColor = result.type === 'medicine' ? 'text-green-600' : 'text-blue-600';
                const icon = result.type === 'medicine' ? 'ğŸŒ¿' : 'ğŸ”';
                
                html += `
                    <div class="search-result ${bgColor} border-2 rounded-lg p-4 mb-4 fade-in" style="animation-delay: ${index * 0.1}s">
                        <h4 class="font-semibold ${iconColor} mb-3 flex items-center">
                            <span class="mr-2">${icon}</span>
                            ${result.title}
                        </h4>
                        <div class="flex flex-wrap gap-2">
                            ${result.items.map(item => `
                                <span class="bg-white px-3 py-1 rounded-full text-sm border shadow-sm hover:shadow-md transition-shadow cursor-pointer" onclick="searchInput.value='${item}'; performSearch();">
                                    ${item}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
        }

        // å°å…¥è³‡æ–™
        function importDataFunction() {
            const data = importData.value.trim();
            if (!data) {
                showImportStatus('è«‹è¼¸å…¥è³‡æ–™', 'error');
                return;
            }

            const lines = data.split('\n').filter(line => line.trim());
            let successCount = 0;
            let errorCount = 0;

            lines.forEach(line => {
                try {
                    processDataLine(line);
                    successCount++;
                } catch (error) {
                    errorCount++;
                }
            });

            updateStatistics();
            
            if (errorCount === 0) {
                showImportStatus(`æˆåŠŸå°å…¥ ${successCount} æ¢è³‡æ–™`, 'success');
                importData.value = '';
            } else {
                showImportStatus(`å°å…¥å®Œæˆï¼šæˆåŠŸ ${successCount} æ¢ï¼Œå¤±æ•— ${errorCount} æ¢`, 'warning');
            }
        }

        // é¡¯ç¤ºå°å…¥ç‹€æ…‹
        function showImportStatus(message, type) {
            const colors = {
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            importStatus.innerHTML = `<div class="${colors[type]} font-medium">${message}</div>`;
            
            setTimeout(() => {
                importStatus.innerHTML = '';
            }, 3000);
        }

        // æ›´æ–°çµ±è¨ˆè³‡æ–™
        function updateStatistics() {
            herbCount.textContent = Object.keys(medicineData).length;
            
            const allSymptoms = new Set();
            Object.values(medicineData).forEach(symptoms => {
                symptoms.forEach(symptom => allSymptoms.add(symptom));
            });
            symptomCount.textContent = allSymptoms.size;
            
            let totalRelations = 0;
            Object.values(medicineData).forEach(symptoms => {
                totalRelations += symptoms.size;
            });
            relationCount.textContent = totalRelations;
        }

        // Firebase ç‹€æ…‹ç®¡ç†
        function updateConnectionStatus(message, color = 'gray') {
            const statusColors = {
                connected: 'bg-green-500',
                error: 'bg-red-500',
                testing: 'bg-yellow-500',
                gray: 'bg-gray-400'
            };
            
            connectionStatus.innerHTML = `
                <div class="w-3 h-3 ${statusColors[color]} rounded-full mr-2 ${color === 'testing' ? 'animate-pulse' : ''}"></div>
                <span class="text-sm text-gray-700">${message}</span>
            `;
        }

        function checkInitialStatus() {
            // æª¢æŸ¥æ˜¯å¦ç‚ºé è¨­é…ç½®
            if (!window.firebaseDB || window.location.hostname === 'localhost') {
                updateConnectionStatus('æœªé…ç½®', 'error');
            } else {
                checkFirebaseConnection();
            }
        }

        async function checkFirebaseConnection() {
            try {
                updateConnectionStatus('æª¢æ¸¬ä¸­', 'testing');
                
                if (!window.firebaseDB) {
                    updateConnectionStatus('æœªé…ç½®', 'error');
                    return false;
                }

                const { doc, getDoc } = window.firebaseModules;
                await getDoc(doc(window.firebaseDB, 'tcm_data', 'connection_test'));
                
                updateConnectionStatus('å·²é€£æ¥', 'connected');
                configNotice.style.display = 'none';
                return true;
                
            } catch (error) {
                updateConnectionStatus('é€£æ¥å¤±æ•—', 'error');
                return false;
            }
        }

        function updateLastSyncTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            lastSync.textContent = timeString;
        }

        // Firebase æ•¸æ“šåº«æ“ä½œ
        async function saveToFirebase() {
            try {
                if (!window.firebaseDB) {
                    showImportStatus('Firebase æœªæ­£ç¢ºé…ç½®', 'error');
                    return;
                }

                const { collection, doc, setDoc } = window.firebaseModules;
                
                // è½‰æ› Set ç‚º Array ä»¥ä¾¿å­˜å„²
                const medicineDataForSave = {};
                Object.keys(medicineData).forEach(key => {
                    medicineDataForSave[key] = Array.from(medicineData[key]);
                });

                const symptomDataForSave = {};
                Object.keys(symptomData).forEach(key => {
                    symptomDataForSave[key] = Array.from(symptomData[key]);
                });

                // ä¿å­˜åˆ° Firebase
                await setDoc(doc(window.firebaseDB, 'tcm_data', 'medicine_data'), {
                    data: medicineDataForSave,
                    lastUpdated: new Date().toISOString()
                });

                await setDoc(doc(window.firebaseDB, 'tcm_data', 'symptom_data'), {
                    data: symptomDataForSave,
                    lastUpdated: new Date().toISOString()
                });

                showImportStatus('è³‡æ–™å·²æˆåŠŸä¿å­˜åˆ°é›²ç«¯', 'success');
                updateLastSyncTime();
            } catch (error) {
                console.error('ä¿å­˜å¤±æ•—:', error);
                showImportStatus('ä¿å­˜å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        async function loadFromFirebase() {
            try {
                if (!window.firebaseDB) {
                    showImportStatus('Firebase æœªæ­£ç¢ºé…ç½®', 'error');
                    return;
                }

                const { doc, getDoc } = window.firebaseModules;

                // å¾ Firebase è¼‰å…¥è³‡æ–™
                const medicineDoc = await getDoc(doc(window.firebaseDB, 'tcm_data', 'medicine_data'));
                const symptomDoc = await getDoc(doc(window.firebaseDB, 'tcm_data', 'symptom_data'));

                if (medicineDoc.exists() && symptomDoc.exists()) {
                    const medicineDataFromDB = medicineDoc.data().data;
                    const symptomDataFromDB = symptomDoc.data().data;

                    // è½‰æ› Array å› Set
                    medicineData = {};
                    Object.keys(medicineDataFromDB).forEach(key => {
                        medicineData[key] = new Set(medicineDataFromDB[key]);
                    });

                    symptomData = {};
                    Object.keys(symptomDataFromDB).forEach(key => {
                        symptomData[key] = new Set(symptomDataFromDB[key]);
                    });

                    updateStatistics();
                    showImportStatus('è³‡æ–™å·²å¾é›²ç«¯è¼‰å…¥', 'success');
                    updateLastSyncTime();
                    resultsContainer.innerHTML = '<div class="text-gray-500 text-center py-12">è³‡æ–™å·²è¼‰å…¥ï¼Œè«‹é–‹å§‹æœå°‹</div>';
                } else {
                    showImportStatus('é›²ç«¯æ²’æœ‰æ‰¾åˆ°è³‡æ–™', 'warning');
                }
            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                showImportStatus('è¼‰å…¥å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        // æ¸…é™¤æ‰€æœ‰è³‡æ–™
        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                medicineData = {};
                symptomData = {};
                updateStatistics();
                resultsContainer.innerHTML = '<div class="text-gray-500 text-center py-12">è³‡æ–™å·²æ¸…é™¤ï¼Œè«‹é‡æ–°å°å…¥</div>';
                showImportStatus('æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤', 'success');
            }
        }

        // äº‹ä»¶ç›£è½å™¨
        searchBtn.addEventListener('click', performSearch);
        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            resultsContainer.innerHTML = '<div class="text-gray-500 text-center py-12">è«‹è¼¸å…¥ç—‡ç‹€æˆ–ä¸­è—¥åç¨±é–‹å§‹æœå°‹</div>';
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        importBtn.addEventListener('click', importDataFunction);
        saveToFirebaseBtn.addEventListener('click', saveToFirebase);
        loadFromFirebaseBtn.addEventListener('click', loadFromFirebase);
        clearDataBtn.addEventListener('click', clearAllData);
        testConnectionBtn.addEventListener('click', checkFirebaseConnection);

        // åˆå§‹åŒ–
        initSampleData();
        
        // å»¶é²æª¢æŸ¥ Firebase é€£æ¥ç‹€æ…‹
        setTimeout(() => {
            checkInitialStatus();
        }, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96542b5af3f28142',t:'MTc1MzUzNTc2NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
