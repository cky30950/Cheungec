<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­é†«è¨ºç—‡è¼”åŠ©å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, deleteDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        
        // Firebase configuration - è«‹æ›¿æ›ç‚ºæ‚¨å¾ Firebase Console ç²å–çš„çœŸå¯¦é…ç½®
        const firebaseConfig = {
            // ğŸ”¥ é‡è¦ï¼šè«‹å°‡ä»¥ä¸‹é…ç½®æ›¿æ›ç‚ºæ‚¨çš„çœŸå¯¦ Firebase é…ç½®
            // å¾ Firebase Console > å°ˆæ¡ˆè¨­å®š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ ä¸­ç²å–
            apiKey: "æ‚¨çš„-API-å¯†é‘°",
            authDomain: "æ‚¨çš„å°ˆæ¡ˆID.firebaseapp.com",
            projectId: "æ‚¨çš„å°ˆæ¡ˆID",
            storageBucket: "æ‚¨çš„å°ˆæ¡ˆID.appspot.com",
            messagingSenderId: "æ‚¨çš„ç™¼é€è€…ID",
            appId: "æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseDB = db;
        window.firebaseUtils = { collection, addDoc, getDocs, doc, setDoc, deleteDoc, getDoc };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .search-result:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-green-500">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">ä¸­</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">ä¸­é†«è¨ºç—‡è¼”åŠ©å·¥å…·</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="firebaseStatus" class="flex items-center space-x-2">
                        <div id="statusIndicator" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        <span id="statusText" class="text-sm text-gray-600">æª¢æŸ¥ä¸­...</span>
                    </div>
                    <div class="relative">
                        <button id="backupMenuBtn" class="flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <span>å‚™ä»½ç®¡ç†</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="backupMenu" class="absolute right-0 top-full mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden">
                            <div class="p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">å‚™ä»½ç®¡ç†</h4>
                                
                                <!-- Auto Backup Toggle -->
                                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm font-medium text-gray-700">è‡ªå‹•å‚™ä»½</span>
                                        <button id="autoBackupToggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none">
                                            <span id="autoBackupSlider" class="inline-block h-4 w-4 transform rounded-full bg-white shadow-lg transition-transform translate-x-1"></span>
                                        </button>
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        ç‹€æ…‹ï¼š<span id="autoBackupStatusText" class="text-red-600">é—œé–‰</span>
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        æœ€å¾Œå‚™ä»½ï¼š<span id="lastBackupText" class="text-gray-400">å¾æœªå‚™ä»½</span>
                                    </div>
                                </div>
                                
                                <!-- Manual Actions -->
                                <div class="space-y-2">
                                    <button id="manualBackupBtn" class="w-full px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-left">
                                        ğŸ’¾ ç«‹å³å‚™ä»½
                                    </button>
                                    <button id="loadFromCloudBtn" class="w-full px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-left">
                                        ğŸ“¥ å¾é›²ç«¯è¼‰å…¥
                                    </button>
                                    <button id="testConnectionBtn" class="w-full px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-left">
                                        ğŸ”— æ¸¬è©¦é€£æ¥
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        å°ˆæ¥­ç‰ˆ v1.0
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Firebase Setup Instructions -->
    <div id="firebaseSetup" class="max-w-6xl mx-auto px-6 py-4">
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r-lg">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-yellow-800">éœ€è¦è¨­ç½® Firebase æ‰èƒ½è·¨è¨­å‚™åŒæ­¥è³‡æ–™</h3>
                    <div class="mt-2 text-sm text-yellow-700">
                        <p>ç›®å‰ä½¿ç”¨ç¤ºç¯„é…ç½®ï¼Œè³‡æ–™åªèƒ½åœ¨æœ¬è¨­å‚™ä½¿ç”¨ã€‚è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿè¨­ç½®çœŸå¯¦çš„ Firebase é…ç½®ï¼š</p>
                        <button id="showSetupGuide" class="mt-2 text-yellow-800 underline hover:text-yellow-900">
                            ğŸ“– æŸ¥çœ‹è©³ç´°è¨­ç½®æ­¥é©Ÿ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Guide Modal -->
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ”¥ Firebase è¨­ç½®æ­¥é©Ÿ</h2>
                        <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Step 1 -->
                        <div class="border-l-4 border-blue-500 pl-4">
                            <h3 class="text-lg font-semibold text-blue-800 mb-2">æ­¥é©Ÿ 1ï¼šå‰µå»º Firebase å°ˆæ¡ˆ</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>å‰å¾€ <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 underline">Firebase Console</a></li>
                                <li>é»æ“Šã€Œå»ºç«‹å°ˆæ¡ˆã€</li>
                                <li>è¼¸å…¥å°ˆæ¡ˆåç¨±ï¼ˆä¾‹å¦‚ï¼štcm-helperï¼‰</li>
                                <li>é¸æ“‡æ˜¯å¦å•Ÿç”¨ Google Analyticsï¼ˆå¯é¸ï¼‰</li>
                                <li>é»æ“Šã€Œå»ºç«‹å°ˆæ¡ˆã€</li>
                            </ol>
                        </div>

                        <!-- Step 2 -->
                        <div class="border-l-4 border-green-500 pl-4">
                            <h3 class="text-lg font-semibold text-green-800 mb-2">æ­¥é©Ÿ 2ï¼šè¨­ç½® Firestore è³‡æ–™åº«</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>åœ¨ Firebase Console ä¸­ï¼Œé»æ“Šå·¦å´é¸å–®çš„ã€ŒFirestore Databaseã€</li>
                                <li>é»æ“Šã€Œå»ºç«‹è³‡æ–™åº«ã€</li>
                                <li>é¸æ“‡ã€Œä»¥æ¸¬è©¦æ¨¡å¼å•Ÿå‹•ã€ï¼ˆ30å¤©å…§å¯è®€å¯«ï¼‰</li>
                                <li>é¸æ“‡è³‡æ–™åº«ä½ç½®ï¼ˆå»ºè­°é¸æ“‡ asia-east1ï¼‰</li>
                                <li>é»æ“Šã€Œå®Œæˆã€</li>
                            </ol>
                        </div>

                        <!-- Step 3 -->
                        <div class="border-l-4 border-purple-500 pl-4">
                            <h3 class="text-lg font-semibold text-purple-800 mb-2">æ­¥é©Ÿ 3ï¼šè¨»å†Šç¶²é æ‡‰ç”¨ç¨‹å¼</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>åœ¨å°ˆæ¡ˆç¸½è¦½é é¢ï¼Œé»æ“Šã€Œ&lt;/&gt;ã€åœ–ç¤ºï¼ˆç¶²é ï¼‰</li>
                                <li>è¼¸å…¥æ‡‰ç”¨ç¨‹å¼æš±ç¨±ï¼ˆä¾‹å¦‚ï¼šä¸­é†«å·¥å…·ï¼‰</li>
                                <li>ä¸éœ€è¦å‹¾é¸ã€Œè¨­å®š Firebase Hostingã€</li>
                                <li>é»æ“Šã€Œè¨»å†Šæ‡‰ç”¨ç¨‹å¼ã€</li>
                            </ol>
                        </div>

                        <!-- Step 4 -->
                        <div class="border-l-4 border-red-500 pl-4">
                            <h3 class="text-lg font-semibold text-red-800 mb-2">æ­¥é©Ÿ 4ï¼šç²å–é…ç½®è³‡è¨Š</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>åœ¨ã€Œæ–°å¢ Firebase SDKã€é é¢ï¼Œè¤‡è£½ firebaseConfig ç‰©ä»¶</li>
                                <li>æˆ–è€…åˆ°ã€Œå°ˆæ¡ˆè¨­å®šã€â†’ã€Œæ‚¨çš„æ‡‰ç”¨ç¨‹å¼ã€â†’ã€ŒSDK è¨­å®šå’Œè¨­å®šã€</li>
                                <li>è¤‡è£½é¡ä¼¼ä»¥ä¸‹çš„é…ç½®ï¼š</li>
                            </ol>
                            <div class="mt-3 bg-gray-100 p-4 rounded-lg">
                                <pre class="text-sm text-gray-800"><code>const firebaseConfig = {
  apiKey: "AIzaSyC...",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123"
};</code></pre>
                            </div>
                        </div>

                        <!-- Step 5 -->
                        <div class="border-l-4 border-yellow-500 pl-4">
                            <h3 class="text-lg font-semibold text-yellow-800 mb-2">æ­¥é©Ÿ 5ï¼šæ›´æ–°ç¨‹å¼ç¢¼</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>å°‡ç²å–çš„é…ç½®è³‡è¨Šæ›¿æ›ç¨‹å¼ç¢¼ä¸­çš„ç¤ºç¯„é…ç½®</li>
                                <li>æ‰¾åˆ°ç¨‹å¼ç¢¼ä¸­çš„ firebaseConfig éƒ¨åˆ†</li>
                                <li>å°‡ã€Œæ‚¨çš„-API-å¯†é‘°ã€ç­‰æ›¿æ›ç‚ºçœŸå¯¦å€¼</li>
                                <li>å„²å­˜ä¸¦é‡æ–°è¼‰å…¥é é¢</li>
                            </ol>
                        </div>

                        <!-- Step 6 -->
                        <div class="border-l-4 border-indigo-500 pl-4">
                            <h3 class="text-lg font-semibold text-indigo-800 mb-2">æ­¥é©Ÿ 6ï¼šè¨­ç½®å®‰å…¨è¦å‰‡ï¼ˆé‡è¦ï¼‰</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>åœ¨ Firestore Database é é¢ï¼Œé»æ“Šã€Œè¦å‰‡ã€æ¨™ç±¤</li>
                                <li>å°‡è¦å‰‡æ›´æ–°ç‚ºä»¥ä¸‹å…§å®¹ï¼ˆæ¸¬è©¦ç”¨ï¼‰ï¼š</li>
                            </ol>
                            <div class="mt-3 bg-gray-100 p-4 rounded-lg">
                                <pre class="text-sm text-gray-800"><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}</code></pre>
                            </div>
                            <p class="text-sm text-red-600 mt-2">âš ï¸ é€™æ˜¯æ¸¬è©¦è¦å‰‡ï¼Œç”Ÿç”¢ç’°å¢ƒéœ€è¦æ›´åš´æ ¼çš„å®‰å…¨è¨­ç½®</p>
                        </div>

                        <!-- Verification -->
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold text-green-800 mb-2">âœ… é©—è­‰è¨­ç½®</h3>
                            <p class="text-gray-700 mb-3">å®Œæˆè¨­ç½®å¾Œï¼Œæ‚¨æ‡‰è©²çœ‹åˆ°ï¼š</p>
                            <ul class="list-disc list-inside space-y-1 text-gray-700">
                                <li>å³ä¸Šè§’ç‹€æ…‹é¡¯ç¤ºã€Œå·²é€£æ¥ã€ï¼ˆç¶ è‰²ï¼‰</li>
                                <li>å¯ä»¥æˆåŠŸåŸ·è¡Œæ‰‹å‹•å‚™ä»½</li>
                                <li>åœ¨å…¶ä»–è¨­å‚™ä¸Šè¼‰å…¥ç›¸åŒè³‡æ–™</li>
                            </ul>
                        </div>

                        <!-- Troubleshooting -->
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold text-red-800 mb-2">ğŸ”§ å¸¸è¦‹å•é¡Œ</h3>
                            <ul class="list-disc list-inside space-y-1 text-gray-700">
                                <li><strong>é€£æ¥å¤±æ•—ï¼š</strong>æª¢æŸ¥é…ç½®æ˜¯å¦æ­£ç¢ºè¤‡è£½</li>
                                <li><strong>æ¬Šé™éŒ¯èª¤ï¼š</strong>ç¢ºèª Firestore è¦å‰‡å·²æ›´æ–°</li>
                                <li><strong>æ‰¾ä¸åˆ°å°ˆæ¡ˆï¼š</strong>ç¢ºèª projectId æ­£ç¢º</li>
                                <li><strong>ç¶²è·¯éŒ¯èª¤ï¼š</strong>æª¢æŸ¥ç¶²è·¯é€£æ¥å’Œé˜²ç«ç‰†è¨­ç½®</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-6 py-8">
        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel - Search -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Search Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        æ™ºèƒ½æœå°‹
                    </h2>
                    
                    <div class="relative mb-4">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="è¼¸å…¥ç—‡ç‹€æˆ–ä¸­è—¥åç¨±é€²è¡Œæœå°‹..."
                            class="w-full px-4 py-3 pl-12 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:outline-none transition-colors text-lg"
                        >
                        <svg class="absolute left-4 top-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>

                    <div class="flex space-x-3 mb-6">
                        <button id="searchSymptom" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium">
                            æœå°‹ç—‡ç‹€
                        </button>
                        <button id="searchHerb" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            æœå°‹ä¸­è—¥
                        </button>
                        <button id="clearSearch" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium">
                            æ¸…é™¤
                        </button>
                    </div>
                </div>

                <!-- Search Results -->
                <div id="searchResults" class="bg-white rounded-xl shadow-lg p-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">æœå°‹çµæœ</h3>
                    <div id="resultsContainer"></div>
                </div>

                <!-- Statistics -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        è³‡æ–™çµ±è¨ˆ
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="herbCount">0</div>
                            <div class="text-sm text-gray-600">ä¸­è—¥ç¨®é¡</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="symptomCount">0</div>
                            <div class="text-sm text-gray-600">ç—‡ç‹€ç¨®é¡</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Data Import -->
            <div class="space-y-6">
                <!-- Data Import Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                        </svg>
                        è³‡æ–™å°å…¥
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            æ ¼å¼ï¼šä¸­è—¥åï¼šç—‡ç‹€1,ç—‡ç‹€2
                        </label>
                        <textarea 
                            id="importData" 
                            rows="8" 
                            placeholder="ç¯„ä¾‹ï¼š&#10;ç•¶æ­¸ï¼šè£œè¡€,èª¿ç¶“,æ½¤è…¸&#10;é»ƒèŠªï¼šè£œæ°£,å›ºè¡¨,åˆ©æ°´&#10;äººåƒï¼šå¤§è£œå…ƒæ°£,å¾©è„ˆå›ºè„«"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors resize-none"
                        ></textarea>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="importBtn" class="flex-1 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors font-medium">
                            å°å…¥è³‡æ–™
                        </button>
                        <button id="clearData" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium">
                            æ¸…ç©º
                        </button>
                    </div>
                </div>

                <!-- Additional Tools -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">å·¥å…·</h3>
                    <div class="space-y-3">
                        <button id="showAllHerbs" class="w-full px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors font-medium text-left">
                            ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰ä¸­è—¥
                        </button>
                        <button id="showAllSymptoms" class="w-full px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors font-medium text-left">
                            ğŸ” æŸ¥çœ‹æ‰€æœ‰ç—‡ç‹€
                        </button>
                        <button id="exportData" class="w-full px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 transition-colors font-medium text-left">
                            ğŸ’¾ åŒ¯å‡ºè³‡æ–™
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span id="toastMessage">æ“ä½œæˆåŠŸ</span>
        </div>
    </div>

    <script>
        // Data storage
        let herbData = {};
        let symptomToHerbs = {};
        
        // Auto backup settings
        let autoBackupEnabled = false;
        let autoBackupInterval = null;
        let lastBackupTime = null;
        const BACKUP_INTERVAL = 30000; // 30 seconds for demo, change to 300000 (5 minutes) for production

        // DOM elements
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const resultsContainer = document.getElementById('resultsContainer');
        const importData = document.getElementById('importData');
        const herbCount = document.getElementById('herbCount');
        const symptomCount = document.getElementById('symptomCount');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        // Initialize with empty data
        function initializeEmptyData() {
            herbData = {};
            symptomToHerbs = {};
            updateStatistics();
        }

        // Process import data
        function processImportData() {
            const data = importData.value.trim();
            if (!data) return;

            const lines = data.split('\n');
            herbData = {};
            symptomToHerbs = {};

            lines.forEach(line => {
                const [herb, symptomsStr] = line.split('ï¼š');
                if (herb && symptomsStr) {
                    const symptoms = symptomsStr.split(',').map(s => s.trim());
                    herbData[herb.trim()] = symptoms;

                    // Build reverse index
                    symptoms.forEach(symptom => {
                        if (!symptomToHerbs[symptom]) {
                            symptomToHerbs[symptom] = [];
                        }
                        if (!symptomToHerbs[symptom].includes(herb.trim())) {
                            symptomToHerbs[symptom].push(herb.trim());
                        }
                    });
                }
            });

            updateStatistics();
            showToast('è³‡æ–™å°å…¥æˆåŠŸï¼');
            
            // Trigger auto backup if enabled
            if (autoBackupEnabled) {
                setTimeout(() => saveToCloudSilent(), 2000);
            }
        }

        // Update statistics
        function updateStatistics() {
            herbCount.textContent = Object.keys(herbData).length;
            symptomCount.textContent = Object.keys(symptomToHerbs).length;
        }

        // Search functionality
        function searchSymptoms(query) {
            const results = [];
            const lowerQuery = query.toLowerCase();

            // Search in symptoms
            Object.keys(symptomToHerbs).forEach(symptom => {
                if (symptom.toLowerCase().includes(lowerQuery)) {
                    results.push({
                        type: 'symptom',
                        name: symptom,
                        herbs: symptomToHerbs[symptom]
                    });
                }
            });

            return results;
        }

        function searchHerbs(query) {
            const results = [];
            const lowerQuery = query.toLowerCase();

            // Search in herbs
            Object.keys(herbData).forEach(herb => {
                if (herb.toLowerCase().includes(lowerQuery)) {
                    results.push({
                        type: 'herb',
                        name: herb,
                        symptoms: herbData[herb]
                    });
                }
            });

            return results;
        }

        // Display search results
        function displayResults(results, searchType) {
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="text-gray-500 text-center py-8">æœªæ‰¾åˆ°ç›¸é—œçµæœ</div>';
                searchResults.classList.remove('hidden');
                return;
            }

            let html = '';
            results.forEach(result => {
                if (result.type === 'symptom') {
                    html += `
                        <div class="search-result bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded-r-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">ç—‡ç‹€ï¼š${result.name}</h4>
                            <div class="text-sm text-gray-700">
                                <span class="font-medium">ç›¸é—œä¸­è—¥ï¼š</span>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    ${result.herbs.map(herb => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${herb}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="search-result bg-green-50 border-l-4 border-green-500 p-4 mb-4 rounded-r-lg">
                            <h4 class="font-semibold text-green-800 mb-2">ä¸­è—¥ï¼š${result.name}</h4>
                            <div class="text-sm text-gray-700">
                                <span class="font-medium">ä¸»æ²»ç—‡ç‹€ï¼š</span>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    ${result.symptoms.map(symptom => `<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">${symptom}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }
            });

            resultsContainer.innerHTML = html;
            searchResults.classList.remove('hidden');
            searchResults.scrollIntoView({ behavior: 'smooth' });
        }

        // Show all data
        function showAllHerbs() {
            const results = Object.keys(herbData).map(herb => ({
                type: 'herb',
                name: herb,
                symptoms: herbData[herb]
            }));
            displayResults(results, 'herb');
        }

        function showAllSymptoms() {
            const results = Object.keys(symptomToHerbs).map(symptom => ({
                type: 'symptom',
                name: symptom,
                herbs: symptomToHerbs[symptom]
            }));
            displayResults(results, 'symptom');
        }

        // Export data
        function exportData() {
            let exportText = '';
            Object.keys(herbData).forEach(herb => {
                exportText += `${herb}ï¼š${herbData[herb].join(',')}\n`;
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ä¸­é†«è³‡æ–™.txt';
            a.click();
            URL.revokeObjectURL(url);
            showToast('è³‡æ–™åŒ¯å‡ºæˆåŠŸï¼');
        }

        // Firebase connection test
        async function testFirebaseConnection() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (!window.firebaseDB) {
                statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                statusText.textContent = 'æœªé…ç½®';
                statusText.className = 'text-sm text-red-600';
                return false;
            }

            try {
                const { doc, getDoc } = window.firebaseUtils;
                
                // Test connection by trying to read a document
                const testDoc = doc(window.firebaseDB, 'test', 'connection');
                await getDoc(testDoc);
                
                statusIndicator.className = 'w-3 h-3 bg-green-500 rounded-full animate-pulse';
                statusText.textContent = 'å·²é€£æ¥';
                statusText.className = 'text-sm text-green-600';
                return true;
            } catch (error) {
                console.error('Firebase é€£æ¥æ¸¬è©¦å¤±æ•—:', error);
                statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                statusText.textContent = 'é€£æ¥å¤±æ•—';
                statusText.className = 'text-sm text-red-600';
                return false;
            }
        }

        // Auto backup functions
        function updateBackupStatusDisplay() {
            const statusText = document.getElementById('autoBackupStatusText');
            const lastBackupText = document.getElementById('lastBackupText');
            const toggle = document.getElementById('autoBackupToggle');
            const slider = document.getElementById('autoBackupSlider');
            
            if (autoBackupEnabled) {
                statusText.textContent = 'é–‹å•Ÿ';
                statusText.className = 'text-green-600';
                toggle.className = 'relative inline-flex h-6 w-11 items-center rounded-full bg-green-500 transition-colors focus:outline-none';
                slider.className = 'inline-block h-4 w-4 transform rounded-full bg-white shadow-lg transition-transform translate-x-6';
            } else {
                statusText.textContent = 'é—œé–‰';
                statusText.className = 'text-red-600';
                toggle.className = 'relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none';
                slider.className = 'inline-block h-4 w-4 transform rounded-full bg-white shadow-lg transition-transform translate-x-1';
            }
            
            if (lastBackupTime) {
                lastBackupText.textContent = lastBackupTime.toLocaleTimeString();
                lastBackupText.className = 'text-blue-600';
            } else {
                lastBackupText.textContent = 'å¾æœªå‚™ä»½';
                lastBackupText.className = 'text-gray-400';
            }
        }

        function startAutoBackup() {
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
            }
            
            autoBackupInterval = setInterval(async () => {
                if (autoBackupEnabled && window.firebaseDB) {
                    await saveToCloudSilent();
                    updateBackupStatusDisplay();
                }
            }, BACKUP_INTERVAL);
            
            autoBackupEnabled = true;
            updateBackupStatusDisplay();
            showToast('è‡ªå‹•å‚™ä»½å·²å•Ÿç”¨ï¼ˆæ¯30ç§’ï¼‰');
        }

        function stopAutoBackup() {
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
                autoBackupInterval = null;
            }
            
            autoBackupEnabled = false;
            updateBackupStatusDisplay();
            showToast('è‡ªå‹•å‚™ä»½å·²åœç”¨');
        }

        function toggleAutoBackup() {
            if (autoBackupEnabled) {
                stopAutoBackup();
            } else {
                startAutoBackup();
            }
        }

        // Firebase functions
        async function saveToCloudSilent() {
            if (!window.firebaseDB) return false;

            try {
                const { setDoc, doc } = window.firebaseUtils;
                
                await setDoc(doc(window.firebaseDB, 'tcm-data', 'herbs'), {
                    data: herbData,
                    lastUpdated: new Date().toISOString(),
                    autoBackup: true
                });

                lastBackupTime = new Date();
                console.log('è‡ªå‹•å‚™ä»½å®Œæˆ:', lastBackupTime.toLocaleTimeString());
                return true;
            } catch (error) {
                console.error('è‡ªå‹•å‚™ä»½å¤±æ•—:', error);
                return false;
            }
        }

        async function saveToCloud() {
            if (!window.firebaseDB) {
                showToast('Firebase æœªæ­£ç¢ºé…ç½®', 'error');
                return;
            }

            try {
                const { setDoc, doc } = window.firebaseUtils;
                
                await setDoc(doc(window.firebaseDB, 'tcm-data', 'herbs'), {
                    data: herbData,
                    lastUpdated: new Date().toISOString(),
                    autoBackup: false
                });

                lastBackupTime = new Date();
                updateBackupStatusDisplay();
                showToast('æ‰‹å‹•å‚™ä»½å®Œæˆï¼');
            } catch (error) {
                console.error('æ‰‹å‹•å‚™ä»½å¤±æ•—:', error);
                showToast('å‚™ä»½å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥', 'error');
            }
        }

        async function loadFromCloud() {
            if (!window.firebaseDB) {
                showToast('Firebase æœªæ­£ç¢ºé…ç½®', 'error');
                return;
            }

            try {
                const { doc, getDoc } = window.firebaseUtils;
                
                // Load herb data from Firestore
                const docRef = doc(window.firebaseDB, 'tcm-data', 'herbs');
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const cloudData = docSnap.data();
                    herbData = cloudData.data || {};
                    
                    // Rebuild symptom index
                    symptomToHerbs = {};
                    Object.keys(herbData).forEach(herb => {
                        herbData[herb].forEach(symptom => {
                            if (!symptomToHerbs[symptom]) {
                                symptomToHerbs[symptom] = [];
                            }
                            if (!symptomToHerbs[symptom].includes(herb)) {
                                symptomToHerbs[symptom].push(herb);
                            }
                        });
                    });

                    // Update import textarea
                    let importText = '';
                    Object.keys(herbData).forEach(herb => {
                        importText += `${herb}ï¼š${herbData[herb].join(',')}\n`;
                    });
                    importData.value = importText;

                    updateStatistics();
                    showToast('é›²ç«¯è³‡æ–™è¼‰å…¥æˆåŠŸï¼');
                } else {
                    showToast('é›²ç«¯æ²’æœ‰æ‰¾åˆ°è³‡æ–™', 'warning');
                }
            } catch (error) {
                console.error('å¾é›²ç«¯è¼‰å…¥å¤±æ•—:', error);
                showToast('è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥', 'error');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            
            // Update toast color based on type
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50 ${
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 
                'bg-green-500'
            } text-white`;
            
            toast.classList.remove('translate-x-full');
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // Setup guide modal functionality
        document.getElementById('showSetupGuide').addEventListener('click', () => {
            document.getElementById('setupModal').classList.remove('hidden');
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('setupModal').classList.add('hidden');
        });

        // Close modal when clicking outside
        document.getElementById('setupModal').addEventListener('click', (e) => {
            if (e.target.id === 'setupModal') {
                document.getElementById('setupModal').classList.add('hidden');
            }
        });

        // Event listeners
        document.getElementById('searchSymptom').addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
                const results = searchSymptoms(query);
                displayResults(results, 'symptom');
            }
        });

        document.getElementById('searchHerb').addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
                const results = searchHerbs(query);
                displayResults(results, 'herb');
            }
        });

        document.getElementById('clearSearch').addEventListener('click', () => {
            searchInput.value = '';
            searchResults.classList.add('hidden');
        });

        document.getElementById('importBtn').addEventListener('click', processImportData);

        document.getElementById('clearData').addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) {
                importData.value = '';
                herbData = {};
                symptomToHerbs = {};
                updateStatistics();
                searchResults.classList.add('hidden');
                showToast('è³‡æ–™å·²æ¸…ç©º');
            }
        });

        document.getElementById('showAllHerbs').addEventListener('click', showAllHerbs);
        document.getElementById('showAllSymptoms').addEventListener('click', showAllSymptoms);
        document.getElementById('exportData').addEventListener('click', exportData);
        
        // Backup menu functionality
        document.getElementById('backupMenuBtn').addEventListener('click', () => {
            const menu = document.getElementById('backupMenu');
            menu.classList.toggle('hidden');
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('backupMenu');
            const btn = document.getElementById('backupMenuBtn');
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });
        
        document.getElementById('autoBackupToggle').addEventListener('click', toggleAutoBackup);
        document.getElementById('manualBackupBtn').addEventListener('click', saveToCloud);
        document.getElementById('loadFromCloudBtn').addEventListener('click', loadFromCloud);
        document.getElementById('testConnectionBtn').addEventListener('click', testFirebaseConnection);

        // Enter key search
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                if (query) {
                    const herbResults = searchHerbs(query);
                    const symptomResults = searchSymptoms(query);
                    const allResults = [...herbResults, ...symptomResults];
                    displayResults(allResults, 'all');
                }
            }
        });

        // Initialize with empty data
        initializeEmptyData();
        
        // Initialize backup status display
        updateBackupStatusDisplay();
        
        // Test Firebase connection on page load
        setTimeout(testFirebaseConnection, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96555481f7c5856a',t:'MTc1MzU0NzkzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
